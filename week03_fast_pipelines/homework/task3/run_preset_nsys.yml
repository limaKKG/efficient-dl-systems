job:
  time_limit: 48h0m0s
  flavor: h100-1x
  region: ix-m5-sm11
  image: python:3.10
  generate_name: task_3_nsys
  work_dir: /work
  env:
    access_key_id: 
    secret_access_key: 

  args:
    - sh
    - -c
    - |
        dpkg -i /from_s3/model/NsightSystems-linux-cli-public-2025.6.1.190-3689520.deb || apt-get install -f -y && \
        pip3 install -qr requirements.txt && \
        nsys profile --env-var CUDA_VISIBLE_DEVICES="0" -o trace_nsys python3 run_epoch.py

  input:
    - type: files
      src: ./
      dst: "/work/"
      mask: "requirements.txt"

    - type: files
      src: ./
      dst: "/work/"
      mask: "*.py"

    - type: s3msk
      src: nsys/
      dst: "/from_s3/model"
      bucket: 
      access_key: 
      secret_key: 

  output:
    - type: files
      src: "/work/trace_nsys.nsys-rep"

