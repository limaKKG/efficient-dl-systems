job:
  time_limit: 48h0m0s
  flavor: h100-1x
  region: ix-m5-sm11
  image: python:3.10
  generate_name: task_3_nsys
  work_dir: /work
  env:
    access_key_id: 00cb14e8a57a13e00e45
    secret_access_key: fc5azqEZBULnWwOI2kneF0KEEmE7VrRZf/OIcego

  args:
    - sh
    - -c
    - |
        dpkg -i /from_s3/model/NsightSystems-linux-cli-public-2025.6.1.190-3689520.deb || apt-get install -f -y && \
        pip3 install -qr requirements.txt && \
        nsys profile --env-var CUDA_VISIBLE_DEVICES="0" -o trace_nsys python3 run_epoch.py

  input:
    - type: files
      src: ./
      dst: "/work/"
      mask: "requirements.txt"

    - type: files
      src: ./
      dst: "/work/"
      mask: "*.py"

    - type: s3msk
      src: NsightSystems-linux-cli-public-2025.6.1.190-3689520.deb
      dst: "/from_s3/model"
      bucket: rnd-customer-service-platform-ml-data
      access_key: 00cb14e8a57a13e00e45
      secret_key: fc5azqEZBULnWwOI2kneF0KEEmE7VrRZf/OIcego

  output:
    - type: files
      src: "/work/trace_nsys.nsys-rep"

